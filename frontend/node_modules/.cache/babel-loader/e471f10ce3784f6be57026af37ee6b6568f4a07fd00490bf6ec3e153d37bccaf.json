{"ast":null,"code":"import React,{useEffect,useState,useCallback}from\"react\";import{FileText,ChevronRight,ChevronLeft,RefreshCw,AlertTriangle,CheckCircle,XCircle,Play,Clock,User,ArrowRight,Package2,Zap,TrendingUp,TrendingDown,Minus}from\"lucide-react\";import api from\"../api/client\";/* ── shared style maps ─────────────────────────────────────────────────── */import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const STATE_STYLE={PROPOSED:\"bg-indigo-500/15 text-indigo-300 border-indigo-500/30\",UNDER_REVIEW:\"bg-amber-500/15  text-amber-300  border-amber-500/30\",APPROVED:\"bg-emerald-500/15 text-emerald-300 border-emerald-500/30\",EXECUTED:\"bg-teal-500/15   text-teal-300   border-teal-500/30\",REJECTED:\"bg-red-500/15    text-red-300    border-red-500/30\",WITHDRAWN:\"bg-slate-500/15  text-slate-400  border-slate-600\"};const TYPE_STYLE={SUBSTITUTION:\"bg-purple-500/15 text-purple-300 border-purple-500/30\",MODIFICATION:\"bg-blue-500/15   text-blue-300   border-blue-500/30\",DECOMMISSION:\"bg-red-500/15    text-red-300    border-red-500/30\",ADDITION:\"bg-emerald-500/15 text-emerald-300 border-emerald-500/30\"};const StateBadge=_ref=>{var _STATE_STYLE$state;let{state}=_ref;return/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex px-2 py-0.5 rounded border text-[10px] font-mono font-semibold\\n    \".concat((_STATE_STYLE$state=STATE_STYLE[state])!==null&&_STATE_STYLE$state!==void 0?_STATE_STYLE$state:\"bg-slate-700 text-slate-300 border-slate-600\"),children:state});};const TypeBadge=_ref2=>{var _TYPE_STYLE$type;let{type}=_ref2;return/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex px-2 py-0.5 rounded border text-[10px] font-mono\\n    \".concat((_TYPE_STYLE$type=TYPE_STYLE[type])!==null&&_TYPE_STYLE$type!==void 0?_TYPE_STYLE$type:\"bg-slate-700 text-slate-400 border-slate-600\"),children:type});};const Spinner=()=>/*#__PURE__*/_jsx(RefreshCw,{size:14,className:\"animate-spin text-slate-500\"});const Err=_ref3=>{let{msg}=_ref3;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-sm text-red-400 bg-red-500/10 border border-red-500/20 rounded px-3 py-2 my-2\",children:[/*#__PURE__*/_jsx(AlertTriangle,{size:13}),\" \",msg]});};const ts=iso=>iso?new Date(iso).toLocaleString():\"—\";const TERMINAL=new Set([\"EXECUTED\",\"REJECTED\",\"WITHDRAWN\"]);/* ── simulation result panel ─────────────────────────────────────────── */const OUTCOME_STYLE={ALLOW:\"text-emerald-300\",FLAG:\"text-amber-300\",DENY:\"text-red-300\"};const SeverityBadge=_ref4=>{var _m$severity;let{severity}=_ref4;const m={CRITICAL:\"bg-red-500/15    text-red-300    border-red-500/30\",WARNING:\"bg-amber-500/15  text-amber-300  border-amber-500/30\",INFORMATIONAL:\"bg-blue-500/15   text-blue-300   border-blue-500/30\"};return/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex px-2 py-0.5 rounded border text-[10px] font-mono font-semibold\\n      \".concat((_m$severity=m[severity])!==null&&_m$severity!==void 0?_m$severity:\"bg-slate-700 text-slate-300 border-slate-600\"),children:severity});};const DeltaIcon=_ref5=>{let{delta}=_ref5;if(delta>0)return/*#__PURE__*/_jsx(TrendingUp,{size:12,className:\"text-red-400\"});if(delta<0)return/*#__PURE__*/_jsx(TrendingDown,{size:12,className:\"text-emerald-400\"});return/*#__PURE__*/_jsx(Minus,{size:12,className:\"text-slate-600\"});};function SimulationPanel(_ref6){var _OUTCOME_STYLE$result;let{amendmentId,onClose}=_ref6;const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[result,setResult]=useState(null);useEffect(()=>{setLoading(true);setError(null);api.post(\"/amendments/\".concat(amendmentId,\"/simulate\")).then(r=>setResult(r.data)).catch(e=>{var _e$response$data$deta,_e$response,_e$response$data,_e$response$data$deta2;return setError((_e$response$data$deta=e===null||e===void 0?void 0:(_e$response=e.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:(_e$response$data$deta2=_e$response$data.detail)===null||_e$response$data$deta2===void 0?void 0:_e$response$data$deta2.message)!==null&&_e$response$data$deta!==void 0?_e$response$data$deta:e.message);}).finally(()=>setLoading(false));},[amendmentId]);return/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 bg-[#0a0a10] border border-indigo-500/20 rounded-lg overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between px-4 py-2.5 border-b border-slate-800 bg-indigo-500/5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Zap,{size:13,className:\"text-indigo-400\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-[11px] font-mono text-indigo-300 uppercase tracking-widest\",children:\"Impact Simulation\"}),result&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-[10px] text-slate-600 font-mono\",children:[\"\\u2014 \",result.simulated_event_type]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-slate-600 hover:text-slate-400 text-xs transition-colors\",children:\"\\u2715\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4\",children:[loading&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-slate-500 text-xs py-2\",children:[/*#__PURE__*/_jsx(Spinner,{}),\" Running simulation\\u2026\"]}),error&&/*#__PURE__*/_jsx(Err,{msg:error}),result&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-[#0d0d14] border border-slate-800 rounded p-3\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-600 font-mono uppercase tracking-wider mb-1\",children:\"Predicted\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-lg font-mono font-bold \".concat((_OUTCOME_STYLE$result=OUTCOME_STYLE[result.predicted_outcome])!==null&&_OUTCOME_STYLE$result!==void 0?_OUTCOME_STYLE$result:\"text-slate-200\"),children:result.predicted_outcome}),result.risk_delta.current_outcome&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-[10px] text-slate-600 mt-0.5\",children:[\"was \",/*#__PURE__*/_jsx(\"span\",{className:OUTCOME_STYLE[result.risk_delta.current_outcome],children:result.risk_delta.current_outcome}),result.risk_delta.outcome_changed&&/*#__PURE__*/_jsx(\"span\",{className:\"text-amber-500 ml-1\",children:\"\\u2190 changed\"})]}),!result.risk_delta.current_outcome&&/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-700 mt-0.5\",children:\"no prior evaluation\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-[#0d0d14] border border-slate-800 rounded p-3\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-600 font-mono uppercase tracking-wider mb-1\",children:\"Critical \\u0394\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1.5\",children:[/*#__PURE__*/_jsx(DeltaIcon,{delta:result.risk_delta.critical_delta}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-lg font-mono font-bold tabular-nums \".concat(result.risk_delta.critical_delta>0?\"text-red-300\":result.risk_delta.critical_delta<0?\"text-emerald-300\":\"text-slate-500\"),children:[result.risk_delta.critical_delta>0?\"+\":\"\",result.risk_delta.critical_delta]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-[#0d0d14] border border-slate-800 rounded p-3\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-600 font-mono uppercase tracking-wider mb-1\",children:\"Warning \\u0394\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1.5\",children:[/*#__PURE__*/_jsx(DeltaIcon,{delta:result.risk_delta.warning_delta}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-lg font-mono font-bold tabular-nums \".concat(result.risk_delta.warning_delta>0?\"text-amber-300\":result.risk_delta.warning_delta<0?\"text-emerald-300\":\"text-slate-500\"),children:[result.risk_delta.warning_delta>0?\"+\":\"\",result.risk_delta.warning_delta]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-[10px] text-slate-500 font-mono uppercase tracking-widest mb-2\",children:[\"Predicted Violations (\",result.predicted_violations.length,\")\"]}),result.predicted_violations.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-xs text-emerald-400 bg-emerald-500/5 border border-emerald-500/20 rounded px-3 py-2\",children:[/*#__PURE__*/_jsx(CheckCircle,{size:12}),\" No violations predicted.\"]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-1.5\",children:result.predicted_violations.map((v,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-[#0d0d14] border border-slate-800 rounded p-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-1\",children:[/*#__PURE__*/_jsx(SeverityBadge,{severity:v.severity}),/*#__PURE__*/_jsx(\"span\",{className:\"text-[10px] font-mono text-slate-400\",children:v.rule_code})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-slate-400\",children:v.message})]},i))})]}),result.affected_downstream_system_ids.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-amber-500/5 border border-amber-500/20 rounded p-3\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-[10px] text-slate-500 font-mono uppercase tracking-widest mb-2\",children:[\"Affected Downstream (\",result.affected_downstream_system_ids.length,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-1.5\",children:result.affected_downstream_system_ids.map(id=>/*#__PURE__*/_jsxs(\"span\",{className:\"text-[10px] font-mono text-amber-300 bg-amber-500/10 border border-amber-500/20 px-2 py-0.5 rounded\",children:[String(id).substring(0,8),\"\\u2026\"]},id))})]})]})]})]});}function ActionPanel(_ref7){let{amendmentId,action,onDone,onCancel}=_ref7;const isExecute=action===\"execute\";const[actor,setActor]=useState(\"\");const[notes,setNotes]=useState(\"\");const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const label={approve:\"Approve\",reject:\"Reject\",execute:\"Execute\"}[action];const actKey=isExecute?\"resolved_by\":\"transitioned_by\";const accent={approve:\"bg-emerald-600 hover:bg-emerald-500\",reject:\"bg-red-700    hover:bg-red-600\",execute:\"bg-teal-700   hover:bg-teal-600\"}[action];const submit=async()=>{if(!actor.trim()){setError(\"Actor name is required.\");return;}setLoading(true);setError(null);try{await api.post(\"/amendments/\".concat(amendmentId,\"/\").concat(action),{[actKey]:actor.trim(),notes:notes.trim()||null});onDone();}catch(e){var _ref8,_e$response$data$deta3,_e$response2,_e$response2$data,_e$response2$data$det,_e$response3,_e$response3$data;setError((_ref8=(_e$response$data$deta3=e===null||e===void 0?void 0:(_e$response2=e.response)===null||_e$response2===void 0?void 0:(_e$response2$data=_e$response2.data)===null||_e$response2$data===void 0?void 0:(_e$response2$data$det=_e$response2$data.detail)===null||_e$response2$data$det===void 0?void 0:_e$response2$data$det.message)!==null&&_e$response$data$deta3!==void 0?_e$response$data$deta3:e===null||e===void 0?void 0:(_e$response3=e.response)===null||_e$response3===void 0?void 0:(_e$response3$data=_e$response3.data)===null||_e$response3$data===void 0?void 0:_e$response3$data.detail)!==null&&_ref8!==void 0?_ref8:e.message);}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 bg-[#0d0d14] border border-slate-700 rounded-lg p-4 space-y-3\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-slate-400 font-mono font-semibold uppercase tracking-widest\",children:[label,\" Amendment\"]}),error&&/*#__PURE__*/_jsx(Err,{msg:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"text-[11px] text-slate-500\",children:[isExecute?\"Resolved by\":\"Actioned by\",\" \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-400\",children:\"*\"})]}),/*#__PURE__*/_jsx(\"input\",{value:actor,onChange:e=>setActor(e.target.value),placeholder:\"actor / system identifier\",className:\"w-full bg-[#09090e] border border-slate-700 rounded px-3 py-1.5 text-xs text-slate-200 placeholder-slate-600 focus:outline-none focus:border-indigo-500 transition-colors\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-[11px] text-slate-500\",children:\"Notes (optional)\"}),/*#__PURE__*/_jsx(\"textarea\",{value:notes,onChange:e=>setNotes(e.target.value),rows:2,placeholder:\"Rationale or context\\u2026\",className:\"w-full bg-[#09090e] border border-slate-700 rounded px-3 py-1.5 text-xs text-slate-200 placeholder-slate-600 focus:outline-none focus:border-indigo-500 transition-colors resize-none\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 pt-1\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:submit,disabled:loading,className:\"px-4 py-1.5 rounded text-xs font-semibold text-white\\n            transition-colors disabled:opacity-40 \".concat(accent),children:loading?\"Submitting…\":\"Confirm \".concat(label)}),/*#__PURE__*/_jsx(\"button\",{onClick:onCancel,disabled:loading,className:\"px-3 py-1.5 rounded text-xs text-slate-400 hover:text-slate-200 border border-slate-700 hover:border-slate-600 transition-colors\",children:\"Cancel\"})]})]});}/* ── amendment detail panel ────────────────────────────────────────────── */function AmendmentDetail(_ref9){var _d$resolved_by,_d$transitions$length,_d$transitions;let{amendmentId,onClose}=_ref9;const[d,setD]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[action,setAction]=useState(null);// \"approve\" | \"reject\" | \"execute\"\nconst[showSim,setShowSim]=useState(false);const load=useCallback(()=>{setLoading(true);setError(null);setAction(null);api.get(\"/amendments/\".concat(amendmentId)).then(r=>setD(r.data)).catch(e=>{var _e$response$data$deta4,_e$response4,_e$response4$data,_e$response4$data$det;return setError((_e$response$data$deta4=e===null||e===void 0?void 0:(_e$response4=e.response)===null||_e$response4===void 0?void 0:(_e$response4$data=_e$response4.data)===null||_e$response4$data===void 0?void 0:(_e$response4$data$det=_e$response4$data.detail)===null||_e$response4$data$det===void 0?void 0:_e$response4$data$det.message)!==null&&_e$response$data$deta4!==void 0?_e$response$data$deta4:e.message);}).finally(()=>setLoading(false));},[amendmentId]);useEffect(()=>{load();},[load]);if(loading)return/*#__PURE__*/_jsxs(\"div\",{className:\"p-5 flex items-center gap-2 text-slate-500\",children:[/*#__PURE__*/_jsx(Spinner,{}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"Loading\\u2026\"})]});if(error)return/*#__PURE__*/_jsx(\"div\",{className:\"p-5\",children:/*#__PURE__*/_jsx(Err,{msg:error})});if(!d)return null;const isTerminal=TERMINAL.has(d.current_state);return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col h-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-5 py-4 border-b border-slate-800 flex items-start justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"min-w-0 flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 flex-wrap\",children:[/*#__PURE__*/_jsx(FileText,{size:14,className:\"text-indigo-400 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-semibold font-mono text-slate-100 truncate\",children:d.amendment_code}),/*#__PURE__*/_jsx(StateBadge,{state:d.current_state}),/*#__PURE__*/_jsx(TypeBadge,{type:d.amendment_type})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-slate-500 mt-1.5 leading-relaxed\",children:d.description})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"ml-3 text-slate-600 hover:text-slate-300 text-sm transition-colors flex-shrink-0\",children:\"\\u2715\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto px-5 py-4 space-y-5\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 gap-3\",children:[[\"Amendment ID\",d.amendment_id,\"mono\"],[\"Target System\",d.target_system_id,\"mono\"],[\"Proposed By\",d.proposed_by,\"\"],[\"Proposed At\",ts(d.proposed_at),\"\"],[\"Resolved By\",(_d$resolved_by=d.resolved_by)!==null&&_d$resolved_by!==void 0?_d$resolved_by:\"—\",\"\"],[\"Resolved At\",ts(d.resolved_at),\"\"]].map(_ref0=>{let[label,val,cls]=_ref0;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-[#0d0d14] border border-slate-800 rounded p-3\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-600 font-mono uppercase tracking-wider mb-1\",children:label}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-slate-300 break-all \".concat(cls===\"mono\"?\"font-mono\":\"\"),children:val})]},label);})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-500 font-mono uppercase tracking-widest mb-2\",children:\"Simulation\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowSim(v=>!v),className:\"flex items-center gap-1.5 px-3 py-1.5 rounded text-xs bg-indigo-600/15 text-indigo-300 border border-indigo-500/30 hover:bg-indigo-600/25 transition-colors\",children:[/*#__PURE__*/_jsx(Zap,{size:12}),\" \",showSim?\"Hide Simulation\":\"Run Impact Simulation\"]}),showSim&&/*#__PURE__*/_jsx(SimulationPanel,{amendmentId:d.amendment_id,onClose:()=>setShowSim(false)})]}),!isTerminal&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-500 font-mono uppercase tracking-widest mb-2\",children:\"Actions\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 flex-wrap\",children:[(d.current_state===\"PROPOSED\"||d.current_state===\"UNDER_REVIEW\")&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setAction(action===\"approve\"?null:\"approve\"),className:\"flex items-center gap-1.5 px-3 py-1.5 rounded text-xs bg-emerald-600/20 text-emerald-300 border border-emerald-600/30 hover:bg-emerald-600/30 transition-colors\",children:[/*#__PURE__*/_jsx(CheckCircle,{size:12}),\" Approve\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setAction(action===\"reject\"?null:\"reject\"),className:\"flex items-center gap-1.5 px-3 py-1.5 rounded text-xs bg-red-600/20 text-red-300 border border-red-600/30 hover:bg-red-600/30 transition-colors\",children:[/*#__PURE__*/_jsx(XCircle,{size:12}),\" Reject\"]})]}),d.current_state===\"APPROVED\"&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setAction(action===\"execute\"?null:\"execute\"),className:\"flex items-center gap-1.5 px-3 py-1.5 rounded text-xs bg-teal-600/20 text-teal-300 border border-teal-600/30 hover:bg-teal-600/30 transition-colors\",children:[/*#__PURE__*/_jsx(Play,{size:12}),\" Execute\"]})]}),action&&/*#__PURE__*/_jsx(ActionPanel,{amendmentId:d.amendment_id,action:action,onDone:load,onCancel:()=>setAction(null)})]}),d.is_consumed&&d.consumption&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-teal-500/5 border border-teal-500/20 rounded-lg p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-3\",children:[/*#__PURE__*/_jsx(Package2,{size:13,className:\"text-teal-400\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-500 font-mono uppercase tracking-widest\",children:\"Consumed\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-2 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-600 font-mono mb-0.5\",children:\"Consumed At\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-300\",children:ts(d.consumption.consumed_at)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-600 font-mono mb-0.5\",children:\"Operation\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-300 font-mono\",children:d.consumption.consumed_by_op})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-600 font-mono mb-0.5\",children:\"Entity\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-300 font-mono text-[10px] break-all\",children:d.consumption.consuming_entity_id})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-600 font-mono mb-0.5\",children:\"Entity Type\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-300\",children:d.consumption.consuming_entity_type})]}),d.consumption.notes&&/*#__PURE__*/_jsxs(\"div\",{className:\"col-span-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-600 font-mono mb-0.5\",children:\"Notes\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-400\",children:d.consumption.notes})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-[10px] text-slate-500 font-mono uppercase tracking-widest mb-2\",children:[\"Transition History (\",(_d$transitions$length=(_d$transitions=d.transitions)===null||_d$transitions===void 0?void 0:_d$transitions.length)!==null&&_d$transitions$length!==void 0?_d$transitions$length:0,\")\"]}),!d.transitions||d.transitions.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-slate-700\",children:\"No transitions recorded.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:d.transitions.map((t,i)=>{var _t$transition_id,_t$from_state;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-[#0d0d14] border border-slate-800 rounded p-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 flex-wrap\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-[10px] font-mono text-slate-500\",children:(_t$from_state=t.from_state)!==null&&_t$from_state!==void 0?_t$from_state:\"—\"}),/*#__PURE__*/_jsx(ArrowRight,{size:10,className:\"text-slate-700 flex-shrink-0\"}),/*#__PURE__*/_jsx(StateBadge,{state:t.to_state}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-auto text-[10px] text-slate-600\",children:ts(t.transitioned_at)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1.5 mt-1.5\",children:[/*#__PURE__*/_jsx(User,{size:10,className:\"text-slate-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-[10px] text-slate-500 font-mono\",children:t.transitioned_by}),t.notes&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-[10px] text-slate-600 ml-2\",children:[\"\\u2014 \",t.notes]})]})]},(_t$transition_id=t.transition_id)!==null&&_t$transition_id!==void 0?_t$transition_id:i);})})]})]})]});}/* ── amendment list ─────────────────────────────────────────────────────── */const STATE_FILTERS=[\"ALL\",\"PROPOSED\",\"UNDER_REVIEW\",\"APPROVED\",\"EXECUTED\",\"REJECTED\",\"WITHDRAWN\"];const PAGE_SIZE=20;export default function AmendmentConsole(){const[amendments,setAmendments]=useState([]);const[total,setTotal]=useState(0);const[page,setPage]=useState(1);const[hasNext,setHasNext]=useState(false);const[stateFilter,setStateFilter]=useState(\"ALL\");const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[selected,setSelected]=useState(null);const load=useCallback(async function(){let pg=arguments.length>0&&arguments[0]!==undefined?arguments[0]:page;let sf=arguments.length>1&&arguments[1]!==undefined?arguments[1]:stateFilter;setLoading(true);setError(null);try{var _res$data$items,_res$data$total,_res$data$has_next;const params={page:pg,page_size:PAGE_SIZE};if(sf!==\"ALL\")params.state=sf;const res=await api.get(\"/amendments\",{params});setAmendments((_res$data$items=res.data.items)!==null&&_res$data$items!==void 0?_res$data$items:[]);setTotal((_res$data$total=res.data.total)!==null&&_res$data$total!==void 0?_res$data$total:0);setHasNext((_res$data$has_next=res.data.has_next)!==null&&_res$data$has_next!==void 0?_res$data$has_next:false);}catch(e){var _ref1,_e$response$data$deta5,_e$response5,_e$response5$data,_e$response5$data$det;setError((_ref1=(_e$response$data$deta5=e===null||e===void 0?void 0:(_e$response5=e.response)===null||_e$response5===void 0?void 0:(_e$response5$data=_e$response5.data)===null||_e$response5$data===void 0?void 0:(_e$response5$data$det=_e$response5$data.detail)===null||_e$response5$data$det===void 0?void 0:_e$response5$data$det.message)!==null&&_e$response$data$deta5!==void 0?_e$response$data$deta5:e.message)!==null&&_ref1!==void 0?_ref1:\"Request failed\");}finally{setLoading(false);}},[page,stateFilter]);useEffect(()=>{load(page,stateFilter);},[page,stateFilter]);// eslint-disable-line\nconst handleFilter=sf=>{setStateFilter(sf);setPage(1);setSelected(null);};const handlePage=pg=>{setPage(pg);setSelected(null);};const handleRefresh=()=>{load(page,stateFilter);setSelected(null);};return/*#__PURE__*/_jsxs(\"div\",{className:\"flex h-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-80 flex-shrink-0 border-r border-slate-800 flex flex-col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 border-b border-slate-800 flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-sm font-semibold text-slate-100\",children:\"Amendments\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleRefresh,disabled:loading,className:\"text-slate-500 hover:text-slate-300 transition-colors disabled:opacity-40\",children:/*#__PURE__*/_jsx(RefreshCw,{size:13,className:loading?\"animate-spin\":\"\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 border-b border-slate-800 flex flex-wrap gap-1\",children:STATE_FILTERS.map(sf=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleFilter(sf),className:\"px-2 py-0.5 rounded text-[10px] font-mono transition-colors border \".concat(stateFilter===sf?\"bg-indigo-600/20 text-indigo-300 border-indigo-500/40\":\"text-slate-500 border-slate-800 hover:text-slate-300 hover:border-slate-700\"),children:sf},sf))}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"p-3\",children:/*#__PURE__*/_jsx(Err,{msg:error})}),loading&&!amendments.length&&/*#__PURE__*/_jsx(\"div\",{className:\"p-4 text-xs text-slate-600 animate-pulse\",children:\"Loading amendments\\u2026\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto\",children:[amendments.map(a=>/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setSelected(a.amendment_id),className:\"w-full text-left px-4 py-3 border-b border-slate-800/50 transition-colors\\n                flex items-start justify-between group border-l-2 \".concat(selected===a.amendment_id?\"bg-indigo-600/10 border-l-indigo-500\":\"hover:bg-slate-800/40 border-l-transparent\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"min-w-0 flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1.5 flex-wrap\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-xs font-mono truncate \".concat(selected===a.amendment_id?\"text-indigo-200\":\"text-slate-300\"),children:a.amendment_code}),/*#__PURE__*/_jsx(StateBadge,{state:a.current_state})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mt-1 flex-wrap\",children:[/*#__PURE__*/_jsx(TypeBadge,{type:a.amendment_type}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-[10px] text-slate-600 font-mono flex items-center gap-1\",children:[/*#__PURE__*/_jsx(User,{size:9}),a.proposed_by]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1 mt-1\",children:[/*#__PURE__*/_jsx(Clock,{size:9,className:\"text-slate-700\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-[10px] text-slate-600\",children:ts(a.proposed_at)})]}),a.latest_transition_at&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-[10px] text-slate-700 mt-0.5 flex items-center gap-1\",children:[/*#__PURE__*/_jsx(ArrowRight,{size:8}),\" last transition \",ts(a.latest_transition_at)]})]}),/*#__PURE__*/_jsx(ChevronRight,{size:12,className:\"flex-shrink-0 ml-2 mt-0.5 transition-colors \".concat(selected===a.amendment_id?\"text-indigo-400\":\"text-slate-700 group-hover:text-slate-500\")})]},a.amendment_id)),!loading&&amendments.length===0&&/*#__PURE__*/_jsxs(\"p\",{className:\"px-4 py-6 text-xs text-slate-600 text-center\",children:[\"No amendments\",stateFilter!==\"ALL\"?\" with state \".concat(stateFilter):\"\",\".\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-2 border-t border-slate-800 flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-[10px] text-slate-700 font-mono\",children:[total,\" total\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1.5\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handlePage(page-1),disabled:page===1||loading,className:\"p-1 rounded border border-slate-800 text-slate-500 hover:text-slate-300 disabled:opacity-30 transition-colors\",children:/*#__PURE__*/_jsx(ChevronLeft,{size:11})}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-[10px] text-slate-600 font-mono\",children:[\"p\",page]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handlePage(page+1),disabled:!hasNext||loading,className:\"p-1 rounded border border-slate-800 text-slate-500 hover:text-slate-300 disabled:opacity-30 transition-colors\",children:/*#__PURE__*/_jsx(ChevronRight,{size:11})})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 min-w-0 overflow-hidden\",children:selected?/*#__PURE__*/_jsx(AmendmentDetail,{amendmentId:selected,onClose:()=>setSelected(null)},selected):/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center h-full text-center px-8\",children:[/*#__PURE__*/_jsx(FileText,{size:32,className:\"text-slate-700 mb-3\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-slate-500\",children:\"Select an amendment to inspect\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-slate-700 mt-1\",children:\"Full history \\xB7 Consumption metadata \\xB7 Lifecycle actions\"})]})})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}